<?xml version="1.0"?>
<workflow
   id="response-workflow"
   title="Response Workflow"
   description="Response to a question"
   initial_state="">

  <state id="responsestates.draft" title="a draft response">
    <grant permission="bungeni.response.Edit" role="bungeni.Owner" />
    <grant permission="bungeni.response.View" role="bungeni.Owner" />    
    <grant permission="bungeni.response.Delete" role="bungeni.Owner" />    
  </state>

  <state id="responsestates.submitted" title="response submitted">
    <grant permission="bungeni.response.Edit" role="bungeni.Clerk"/>
    <grant permission="bungeni.response.View" role="bungeni.Clerk"/>    
    <deny permission="bungeni.response.Edit" role="bungeni.Owner"/>
    <deny permission="bungeni.response.Delete" role="bungeni.Owner" />
  </state>

  <state id="responsestates.complete" title="response completed">
    <deny permission="bungeni.response.Edit" role="bungeni.Clerk" />
    <grant permission="bungeni.response.View" role="bungeni.Everybody" />
  </state>

  <transition 
     id="create"
     title="Create"
     trigger="automatic"
     source=""
     destination="responsestates.draft"
     action="bungeni.core.workflows.response.actions.create"
     />

  <transition 
     id="submit"
     title="Submit Response"
     trigger="manual"
     source="responsestates.draft"
     destination="responsestates.submitted"
     permission="bungeni.response.Submit" 
     condition="bungeni.core.workflows.utils.resonse_allow_submit"
     action="bungeni.core.workflows.response.actions.submit"
     event="bungeni.core.workflows.interfaces.IResponseSubmittedEvent"
     />

  <transition
     id="re-draft"
     title="Re draft response"
     trigger="manual"
     source="responsestates.submitted"     
     destination="responsestates.draft"
     permission="bungeni.response.RevertTransitions" 
     condition=""
     action=""
     event=""
     />    


  <transition 
     id="complete"
     title="Complete Response"
     trigger="manual"
     source="responsestates.submitted"
     destination="responsestates.complete"
     permission="bungeni.response.Complete" 
     condition="bungeni.core.workflows.utils.response_allow_complete"
     action="bungeni.core.workflows.response.actions.complete"
     event="bungeni.core.workflows.interfaces.IResponseCompletedEvent"     
     />

</workflow>
