<?xml version="1.0"?>
<workflow
   id="bill-workflow"
   title="bill Workflow"
   description="A bill"
   initial_state="">

  <state id="bungeni.core.workflows.wfstates.motionstates.draft" title="draft motion">
    <grant permission="bungeni.motion.edit" role="bungeni.Owner" />
    <grant permission="bungeni.motion.view" role="bungeni.Owner" />    
    <grant permission="bungeni.motion.delete" role="bungeni.Owner" />    
  </state>

  <state id="bungeni.core.workflows.wfstates.motionstates.submitted" title="Motion submitted">
    <deny permission="bungeni.motion.edit" role="bungeni.Owner" />
    <!--deny permission="bungeni.motion.view" role="bungeni.Owner" /-->    
    <deny permission="bungeni.motion.delete" role="bungeni.Owner" />    
    <!--grant permission="bungeni.motion.edit" role="bungeni.Clerk" /-->
    <grant permission="bungeni.motion.view" role="bungeni.Clerk" />      
  </state>

  <state id="bungeni.core.workflows.wfstates.motionstates.received" title="Motion received by clerks office">  
    <grant permission="bungeni.motion.edit" role="bungeni.Clerk" />
    <grant permission="bungeni.motion.view" role="bungeni.Clerk" />      
  </state>

  <state id="bungeni.core.workflows.wfstates.motionstates.complete" title="Motion complete">  
    <deny permission="bungeni.motion.edit" role="bungeni.Clerk" />
    <grant permission="bungeni.motion.edit" role="bungeni.Speaker" />
    <grant permission="bungeni.motion.view" role="bungeni.Speaker" />         
  </state>

  <state id="bungeni.core.workflows.wfstates.motionstates.admissible" title="Motion admissible">  
      <grant permission="bungeni.motion.view" role="bungeni.Everybody" />         
  </state>    

  <state id="bungeni.core.workflows.wfstates.motionstates.inadmissible" title="Motion inadmissible">     
    <deny permission="bungeni.motion.edit" role="bungeni.Speaker" />
  </state>
      
  <state id="bungeni.core.workflows.wfstates.motionstates.clarify_clerk" title="Motion needs clarification by Clerks Office">     
    <deny permission="bungeni.motion.edit" role="bungeni.Speaker" />    
    <grant permission="bungeni.motion.edit" role="bungeni.Clerk" />
  </state>

  <state id="bungeni.core.workflows.wfstates.motionstates.clarify_mp" title="Motion needs clarification by MP">  
    <deny permission="bungeni.motion.edit" role="bungeni.Clerk" />
    <grant permission="bungeni.motion.edit" role="bungeni.Speaker" />    
    <deny permission="bungeni.motion.edit" role="bungeni.Owner" />         
  </state>





  <!-- is scheduled for debate at a sitting -->
  <state id="bungeni.core.workflows.wfstates.motionstates.scheduled" title="Motion scheduled">  
    <deny permission="bungeni.motion.edit" role="bungeni.Clerk" />      
    <deny permission="bungeni.motion.edit" role="bungeni.Speaker" />
  </state>    
  <!-- admissable motion that cannot be debated -->
  <state id="bungeni.core.workflows.wfstates.motionstates.deferred" title="Motion deferred">  

  </state>    
  <!--motion was scheduled for but not debated at the sitting -->
  <state id="bungeni.core.workflows.wfstates.motionstates.postponed" title="Motion postponed">  

  </state>    
  <!--defered or postponed motion that were not debated -->
  <state id="bungeni.core.workflows.wfstates.motionstates.elapsed" title="Motion elapsed">  
    <deny permission="bungeni.motion.edit" role="bungeni.Clerk" />      
    <deny permission="bungeni.motion.edit" role="bungeni.Speaker" />
  </state>    
  <!--a motion was debated  -->
  <state id="bungeni.core.workflows.wfstates.motionstates.debated" title="Motion debated">  
    <deny permission="bungeni.motion.edit" role="bungeni.Clerk" />      
    <deny permission="bungeni.motion.edit" role="bungeni.Speaker" />
  </state>
  

  <state id="bungeni.core.workflows.wfstates.motionstates.withdrawn" title="Motion withdrawn">  
    <deny permission="bungeni.motion.edit" role="bungeni.Clerk" />      
    <deny permission="bungeni.motion.edit" role="bungeni.Speaker" />
    <deny permission="bungeni.motion.edit" role="bungeni.Owner" /> 
  </state>


  <transition
    id="create"
    title="Create"
    trigger="automatic"
    source=""
    destination="bungeni.core.workflows.wfstates.motionstates.draft"
    permission=""
    action="bungeni.core.workflows.motionactions.create"
    condition=""
  />
  <!--transition
    id="make-private"
    title="Make private"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.draft_motion"
    destination="bungeni.core.workflows.wfstates.motionstates.private_motion"
    permission="bungeni.motion.Submit"
    action=""
    condition=""
  /-->
  <!--transition
    id="re-draft"
    title="Re draft"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.private_motion"
    destination="bungeni.core.workflows.wfstates.motionstates.draft_motion"
    permission="bungeni.motion.Submit"
    action=""
    condition=""
  /-->
  
  <transition
    id="submit-to-clerk"
    title="Submit to Clerk"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.draft"
    destination="bungeni.core.workflows.wfstates.motionstates.submitted"
    permission="bungeni.motion.Submit"
    action="bungeni.core.workflows.motionactions.submit"
    condition=""
  />
  
  <transition
    id="received-by-clerk"
    title="Receive"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.submitted"
    destination="bungeni.core.workflows.wfstates.motionstates.received"
    permission="bungeni.motion.Recieve"
    action="bungeni.core.workflows.motionactions.recieved_by_clerk"
    condition=""
  />
  <transition
    id="require-edit-by-mp"
    title="Needs Clarification by MP"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.received"
    destination="bungeni.core.workflows.wfstates.motionstates.clarify_mp"
    permission="bungeni.motion.clerk.Review"
    action="bungeni.core.workflows.motionactions.require_edit_by_mp"
    condition=""
  />
  <transition
    id="complete"
    title="Complete"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.received"
    destination="bungeni.core.workflows.wfstates.motionstates.complete"
    permission="bungeni.motion.clerk.Review"
    action="bungeni.core.workflows.motionactions.complete"
    condition=""
  />
  <transition
    id="approve"
    title="Approve"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.complete"
    destination="bungeni.core.workflows.wfstates.motionstates.admissible"
    permission="bungeni.motion.speaker.Review"
    action="bungeni.core.workflows.motionactions.approve"
    condition=""
  />
  <transition
    id="reject"
    title="Reject"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.complete"
    destination="bungeni.core.workflows.wfstates.motionstates.inadmissible"
    permission="bungeni.motion.speaker.Review"
    action="bungeni.core.workflows.motionactions.reject"
    condition=""
  />
  <transition
    id="require-amendment"
    title="Needs Clarification"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.complete"
    destination="bungeni.core.workflows.wfstates.motionstates.clarify_clerk"
    permission="bungeni.motion.speaker.Review"
    action="bungeni.core.workflows.motionactions.require_amendment"
    condition=""
  />
  <transition
    id="complete-clarify"
    title="Complete"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.clarify_clerk"
    destination="bungeni.core.workflows.wfstates.motionstates.complete"
    permission="bungeni.motion.clerk.Review"
    action=""
    condition=""
  />
  <transition
    id="mp-clarify"
    title="Needs Clarification by MP"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.clarify_clerk"
    destination="bungeni.core.workflows.wfstates.motionstates.clarify_mp"
    permission="bungeni.motion.clerk.Review"
    action="bungeni.core.workflows.motionactions.mp_clarify"
    condition=""
  />
  <transition
    id="resubmit-clerk"
    title="Resubmit to clerk"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.clarify_mp"
    destination="bungeni.core.workflows.wfstates.motionstates.submitted"
    permission="bungeni.motion.Submit"
    action="bungeni.core.workflows.motionactions.submit"
    condition=""
  />
  <transition
    id="schedule"
    title="Schedule"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.admissible"
    destination="bungeni.core.workflows.wfstates.motionstates.scheduled"
    permission="bungeni.motion.Schedule"
    action="bungeni.core.workflows.motionactions.schedule"
    condition="bungeni.core.workflows.utils.getMotionSchedule"
  />
  <transition
    id="defer"
    title="Defer"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.admissible"
    destination="bungeni.core.workflows.wfstates.motionstates.deferred"
    permission="bungeni.motion.Schedule"
    action="bungeni.core.workflows.motionactions.defer"
    condition=""
  />
  <transition
    id="elapse-defered"
    title="Elapse"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.deferred"
    destination="bungeni.core.workflows.wfstates.motionstates.elapsed"
    permission="bungeni.motion.Schedule"
    action="bungeni.core.workflows.motionactions.elapse"
    condition=""
  />
  <transition
    id="schedule-deferred"
    title="Schedule"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.deferred"
    destination="bungeni.core.workflows.wfstates.motionstates.scheduled"
    permission="bungeni.motion.Schedule"
    action="bungeni.core.workflows.motionactions.schedule"
    condition="bungeni.core.workflows.utils.getMotionSchedule"
  />
  <transition
    id="postpone"
    title="Postpone"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.scheduled"
    destination="bungeni.core.workflows.wfstates.motionstates.postponed"
    permission="bungeni.motion.Schedule"
    action="bungeni.core.workflows.motionactions.postpone"
    condition=""
  />
  <transition
    id="debate"
    title="Debate"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.scheduled"
    destination="bungeni.core.workflows.wfstates.motionstates.debated"
    permission="bungeni.motion.Debate"
    action="bungeni.core.workflows.motionactions.debate"
    condition=""
  />
  <transition
    id="schedule-postponed"
    title="Schedule"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.postponed"
    destination="bungeni.core.workflows.wfstates.motionstates.scheduled"
    permission="bungeni.motion.Schedule"
    action="bungeni.core.workflows.motionactions.schedule"
    condition="bungeni.core.workflows.utils.getMotionSchedule"
  />
  <transition
    id="elapse-postponed"
    title="Elapse"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.postponed"
    destination="bungeni.core.workflows.wfstates.motionstates.elapsed"
    permission="bungeni.motion.Schedule"
    action="bungeni.core.workflows.motionactions.elapse"
    condition=""
  />
  <transition
    id="withdraw-submitted"
    title="Withdraw"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.submitted"
    destination="bungeni.core.workflows.wfstates.motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motionactions.withdraw"
    condition=""
  />
  <transition
    id="withdraw-received"
    title="Withdraw"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.received"
    destination="bungeni.core.workflows.wfstates.motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motionactions.withdraw"
    condition=""
  />
  <transition
    id="withdraw-complete"
    title="Withdraw"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.complete"
    destination="bungeni.core.workflows.wfstates.motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motionactions.withdraw"
    condition=""
  />
  <transition
    id="withdraw-admissible"
    title="Withdraw"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.admissible"
    destination="bungeni.core.workflows.wfstates.motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motionactions.withdraw"
    condition=""
  />
  <transition
    id="withdraw-amend"
    title="Withdraw"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.clarify_mp"
    destination="bungeni.core.workflows.wfstates.motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motionactions.withdraw"
    condition=""
  />
  <transition
    id="withdraw-scheduled"
    title="Withdraw"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.scheduled"
    destination="bungeni.core.workflows.wfstates.motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motionactions.withdraw"
    condition=""
  />
  <transition
    id="withdraw-deferred"
    title="Withdraw"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.deferred"
    destination="bungeni.core.workflows.wfstates.motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motionactions.withdraw"
    condition=""
  />
  <transition
    id="withdraw-postponed"
    title="Withdraw"
    trigger="manual"
    source="bungeni.core.workflows.wfstates.motionstates.postponed"
    destination="bungeni.core.workflows.wfstates.motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motionactions.withdraw"
    condition=""
  />
  
</workflow>    
