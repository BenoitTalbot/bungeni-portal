<?xml version="1.0"?>
<workflow
   id="bill-workflow"
   title="bill Workflow"
   description="A bill"
   initial_state="">

  <state id="draft" title="Draft Motion">
    <grant permission="bungeni.motion.Edit" role="bungeni.Owner" />
    <grant permission="zope.View" role="bungeni.Owner" />    
    <grant permission="bungeni.motion.Delete" role="bungeni.Owner" />   
    <deny permission="zope.View" role="bungeni.MP" />     
    <deny permission="zope.View" role="bungeni.Clerk" />       
    <deny permission="zope.View" role="bungeni.Speaker" />  
    <deny permission="zope.View" role="bungeni.Minister" />  
    <deny permission="zope.View" role="bungeni.Everybody" /> 
    <deny permission="zope.View" role="bungeni.Anybody" />    
    <grant permission="bungeni.consignatory.Add" role="bungeni.Owner" />
    <grant permission="bungeni.consignatory.Delete" role="bungeni.Owner" />          
  </state>

  <state id="submitted" title="Motion Submitted">  
    <deny permission="bungeni.consignatory.Add" role="bungeni.Owner" />
    <deny permission="bungeni.consignatory.Delete" role="bungeni.Owner" />     
    <deny permission="bungeni.motion.Edit" role="bungeni.Owner" />
    <!--deny permission="zope.View" role="bungeni.Owner" /-->    
    <deny permission="bungeni.motion.Delete" role="bungeni.Owner" />    
    <!--grant permission="bungeni.motion.Edit" role="bungeni.Clerk" /-->
    <grant permission="zope.View" role="bungeni.Clerk" />      
  </state>

  <state id="received" title="Motion Received by Clerks Office">  
    <grant permission="bungeni.consignatory.Add" role="bungeni.Clerk" />
    <grant permission="bungeni.consignatory.Delete" role="bungeni.Clerk" />     
    <grant permission="bungeni.motion.Edit" role="bungeni.Clerk" />
    <grant permission="zope.View" role="bungeni.Clerk" />      
  </state>

  <state id="complete" title="Motion Complete">  
    <deny permission="bungeni.motion.Edit" role="bungeni.Clerk" />
    <grant permission="bungeni.motion.Edit" role="bungeni.Speaker" />
    <grant permission="zope.View" role="bungeni.Speaker" />         
    <deny permission="bungeni.consignatory.Add" role="bungeni.Clerk" />
    <deny permission="bungeni.consignatory.Delete" role="bungeni.Clerk" />   
    <grant permission="bungeni.consignatory.Add" role="bungeni.Speaker" />
    <grant permission="bungeni.consignatory.Delete" role="bungeni.Speaker" />      
  </state>

  <state id="admissible" title="Motion Admissible">  
    <grant permission="zope.View" role="bungeni.Everybody" />   
    <grant permission="zope.View" role="bungeni.Anybody" />    
    <grant permission="bungeni.motion.Edit" role="bungeni.Speaker" />
    <grant permission="zope.View" role="bungeni.Speaker" />      
    <deny permission="bungeni.consignatory.Add" role="bungeni.Speaker" />
    <dent permission="bungeni.consignatory.Delete" role="bungeni.Speaker" />               
  </state>    

  <state id="inadmissible" title="Motion Inadmissible">     
    <deny permission="bungeni.motion.Edit" role="bungeni.Speaker" /> 
    <deny permission="bungeni.consignatory.Add" role="bungeni.Speaker" />
    <deny permission="bungeni.consignatory.Delete" role="bungeni.Speaker" />  
  </state>
  
  <state id="clarify_clerk" title="Motion Needs Clarification by Clerks Office">     
    <deny permission="bungeni.motion.Edit" role="bungeni.Speaker" />    
    <grant permission="bungeni.motion.Edit" role="bungeni.Clerk" /> 
    <grant permission="bungeni.consignatory.Add" role="bungeni.Clerk" />
    <grant permission="bungeni.consignatory.Delete" role="bungeni.Clerk" />   
    <deny permission="bungeni.consignatory.Add" role="bungeni.Speaker" />
    <deny permission="bungeni.consignatory.Delete" role="bungeni.Speaker" />      
  </state>

  <state id="clarify_mp" title="Motion Needs Clarification by MP">  
    <deny permission="bungeni.motion.Edit" role="bungeni.Clerk" />
    <grant permission="bungeni.motion.Edit" role="bungeni.Owner" />    
    <grant permission="bungeni.consignatory.Add" role="bungeni.Owner" />
    <grant permission="bungeni.consignatory.Delete" role="bungeni.Owner" />   
    <deny permission="bungeni.consignatory.Add" role="bungeni.Clerk" />
    <deny permission="bungeni.consignatory.Delete" role="bungeni.Clerk" />     
  </state>





  <!-- is scheduled for debate at a sitting -->
  <state id="scheduled" title="Motion Scheduled">  
    <deny permission="bungeni.motion.Edit" role="bungeni.Clerk" />      
    <deny permission="bungeni.motion.Edit" role="bungeni.Speaker" />
  </state>    
  <!-- admissable motion that cannot be debated -->
  <state id="deferred" title="Motion Deferred">  

  </state>    
  <!--motion was scheduled for but not debated at the sitting -->
  <state id="postponed" title="Motion Postponed">  

  </state>    
  <!--defered or postponed motion that were not debated -->
  <state id="elapsed" title="Motion Elapsed">  
    <deny permission="bungeni.motion.Edit" role="bungeni.Clerk" />      
    <deny permission="bungeni.motion.Edit" role="bungeni.Speaker" />
  </state>    
  <!--a motion was debated  -->
  <state id="debated" title="Motion Debated">  
    <deny permission="bungeni.motion.Edit" role="bungeni.Clerk" />      
    <deny permission="bungeni.motion.Edit" role="bungeni.Speaker" />
  </state>
  

  <state id="withdrawn" title="Motion Withdrawn">  
    <deny permission="bungeni.motion.Edit" role="bungeni.Clerk" />      
    <deny permission="bungeni.motion.Edit" role="bungeni.Speaker" />
    <deny permission="bungeni.motion.Edit" role="bungeni.Owner" /> 
    <deny permission="bungeni.consignatory.Add" role="bungeni.Owner" />
    <deny permission="bungeni.consignatory.Delete" role="bungeni.Owner" />   
    <deny permission="bungeni.consignatory.Add" role="bungeni.Clerk" />
    <deny permission="bungeni.consignatory.Delete" role="bungeni.Clerk" />   
    <deny permission="bungeni.consignatory.Add" role="bungeni.Speaker" />
    <deny permission="bungeni.consignatory.Delete" role="bungeni.Speaker" />      
  </state>


  <transition
     id="create"
     title="Create"
     trigger="automatic"
     source=""
     destination="draft"
     permission=""
     action="bungeni.core.workflows.motion.actions.create"
     condition=""
     />
  <!--transition
      id="make-private"
      title="Make private"
      trigger="manual"
      source="draft_motion"
      destination="private_motion"
      permission="bungeni.motion.Submit"
      action=""
      condition=""
      /-->
  <!--transition
      id="re-draft"
      title="Re draft"
      trigger="manual"
      source="private_motion"
      destination="draft_motion"
      permission="bungeni.motion.Submit"
      action=""
      condition=""
      /-->
  
  <transition
     id="submit-to-clerk"
     title="Submit to Clerk"
     trigger="manual"
     source="draft"
     destination="submitted"
     permission="bungeni.motion.Submit"
     action="bungeni.core.workflows.motion.actions.submit"
     condition=""
     event="bungeni.core.workflows.interfaces.IMotionSubmittedEvent"
     />
  
  <transition
     id="received-by-clerk"
     title="Receive"
     trigger="manual"
     source="submitted"
     destination="received"
     permission="bungeni.motion.Recieve"
     action="bungeni.core.workflows.motion.actions.received_by_clerk"
     condition=""
     event="bungeni.core.workflows.interfaces.IMotionReceivedEvent"
     />
  <transition
     id="require-edit-by-mp"
     title="Needs Clarification by MP"
     trigger="manual"
     source="received"
     destination="clarify_mp"
     permission="bungeni.motion.clerk.Review"
     action="bungeni.core.workflows.motion.actions.require_edit_by_mp"
     condition=""
     event="bungeni.core.workflows.interfaces.IMotionClarifyEvent"
     />
  <transition
     id="complete"
     title="Complete"
     trigger="manual"
     source="received"
     destination="complete"
     permission="bungeni.motion.clerk.Review"
     action="bungeni.core.workflows.motion.actions.complete"
     condition=""
     />
  <transition
     id="approve"
     title="Approve"
     trigger="manual"
     source="complete"
     destination="admissible"
     permission="bungeni.motion.speaker.Review"
     action="bungeni.core.workflows.motion.actions.approve"
     condition=""
     />
  <transition
     id="reject"
     title="Reject"
     trigger="manual"
     source="complete"
     destination="inadmissible"
     permission="bungeni.motion.speaker.Review"
     action="bungeni.core.workflows.motion.actions.reject"
     condition=""
     event="bungeni.core.workflows.interfaces.IMotionRejectedEvent"
     />
  
  <transition
     id="redraft-inadmissible"
     title="Redraft Rejected"
     trigger="manual"
     source="inadmissible"
     destination="draft"
     permission="bungeni.motion.RevertTransitions"
     action=""
     condition=""
     event=""
     />

  
  <transition
     id="require-amendment"
     title="Needs Clarification"
     trigger="manual"
     source="complete"
     destination="clarify_clerk"
     permission="bungeni.motion.speaker.Review"
     action="bungeni.core.workflows.motion.actions.require_amendment"
     condition=""
     />
  <transition
     id="complete-clarify"
     title="Complete"
     trigger="manual"
     source="clarify_clerk"
     destination="complete"
     permission="bungeni.motion.clerk.Review"
     action=""
     condition=""
     />
  <transition
     id="mp-clarify"
     title="Needs Clarification by MP"
     trigger="manual"
     source="clarify_clerk"
     destination="clarify_mp"
     permission="bungeni.motion.clerk.Review"
     action="bungeni.core.workflows.motion.actions.mp_clarify"
     condition=""
     event="bungeni.core.workflows.interfaces.IMotionClarifyEvent"    
     />
  <transition
     id="resubmit-clerk"
     title="Resubmit to clerk"
     trigger="manual"
     source="clarify_mp"
     destination="submitted"
     permission="bungeni.motion.Submit"
     action="bungeni.core.workflows.motion.actions.submit"
     condition=""
     />
  <transition
     id="schedule"
     title="Schedule"
     trigger="manual"
     source="admissible"
     destination="scheduled"
     permission="bungeni.motion.Schedule"
     action="bungeni.core.workflows.motion.actions.schedule"
     condition="bungeni.core.workflows.motion.conditions.is_scheduled"
     event="bungeni.core.workflows.interfaces.IMotionScheduledEvent"
     />
  <transition
     id="defer"
     title="Defer"
     trigger="manual"
     source="admissible"
     destination="deferred"
     permission="bungeni.motion.Schedule"
     action="bungeni.core.workflows.motion.actions.defer"
     condition=""
     event="bungeni.core.workflows.interfaces.IMotionDeferredEvent"
     />
  <transition
     id="elapse-defered"
     title="Elapse"
     trigger="manual"
     source="deferred"
     destination="elapsed"
     permission="bungeni.motion.Schedule"
     action="bungeni.core.workflows.motion.actions.elapse"
     condition=""
     />

  <transition
     id="re-admit-elapsed"
     title="Readmit elpapsed"
     trigger="manual"
     source="elapsed"
     destination="admissible"
     permission="bungeni.motion.RevertTransitions"
     action="bungeni.core.workflows.motion.actions.approve"
     condition=""
     />  
  
  <transition
     id="schedule-deferred"
     title="Schedule"
     trigger="manual"
     source="deferred"
     destination="scheduled"
     permission="bungeni.motion.Schedule"
     action="bungeni.core.workflows.motion.actions.schedule"
     condition="bungeni.core.workflows.motion.conditions.is_scheduled"
     event="bungeni.core.workflows.interfaces.IMotionScheduledEvent"    
     />
  <transition
     id="postpone"
     title="Postpone"
     trigger="manual"
     source="scheduled"
     destination="postponed"
     permission="bungeni.motion.Schedule"
     action="bungeni.core.workflows.motion.actions.postpone"
     condition=""
     event="bungeni.core.workflows.interfaces.IMotionPostponedEvent"
     />
  <transition
     id="debate"
     title="Debate"
     trigger="manual"
     source="scheduled"
     destination="debated"
     permission="bungeni.motion.Debate"
     action="bungeni.core.workflows.motion.actions.debate"
     condition=""
     event="bungeni.core.workflows.interfaces.IMotionDebatedEvent"
     />
  <transition
     id="schedule-postponed"
     title="Schedule"
     trigger="manual"
     source="postponed"
     destination="scheduled"
     permission="bungeni.motion.Schedule"
     action="bungeni.core.workflows.motion.actions.schedule"
     condition="bungeni.core.workflows.motion.conditions.is_scheduled"
     event="bungeni.core.workflows.interfaces.IMotionScheduledEvent"    
     />
  <transition
     id="elapse-postponed"
     title="Elapse"
     trigger="manual"
     source="postponed"
     destination="elapsed"
     permission="bungeni.motion.Schedule"
     action="bungeni.core.workflows.motion.actions.elapse"
     condition=""
     />
  
  <transition
     id="withdraw"
     title="Withdraw"
     trigger="manual"
     source="submitted
             received
             complete
             admissible
             clarify_mp
             scheduled
             deferred
             postponed"
     destination="withdrawn"
     permission="bungeni.motion.Withdraw"
     action="bungeni.core.workflows.motion.actions.withdraw"
     condition=""
     require_confirmation="true"
     />
  
</workflow>
