<?xml version="1.0"?>
<workflow
   id="bill-workflow"
   title="bill Workflow"
   description="A bill"
   initial_state="">

  <state id="motionstates.draft" title="draft motion">
    <grant permission="bungeni.motion.Edit" role="bungeni.Owner" />
    <grant permission="bungeni.motion.View" role="bungeni.Owner" />    
    <grant permission="bungeni.motion.Delete" role="bungeni.Owner" />    
  </state>

  <state id="motionstates.submitted" title="Motion submitted">
    <deny permission="bungeni.motion.Edit" role="bungeni.Owner" />
    <!--deny permission="bungeni.motion.View" role="bungeni.Owner" /-->    
    <deny permission="bungeni.motion.Delete" role="bungeni.Owner" />    
    <!--grant permission="bungeni.motion.Edit" role="bungeni.Clerk" /-->
    <grant permission="bungeni.motion.View" role="bungeni.Clerk" />      
  </state>

  <state id="motionstates.received" title="Motion received by clerks office">  
    <grant permission="bungeni.motion.Edit" role="bungeni.Clerk" />
    <grant permission="bungeni.motion.View" role="bungeni.Clerk" />      
  </state>

  <state id="motionstates.complete" title="Motion complete">  
    <deny permission="bungeni.motion.Edit" role="bungeni.Clerk" />
    <grant permission="bungeni.motion.Edit" role="bungeni.Speaker" />
    <grant permission="bungeni.motion.View" role="bungeni.Speaker" />         
  </state>

  <state id="motionstates.admissible" title="Motion admissible">  
    <grant permission="bungeni.motion.View" role="bungeni.Everybody" />   
    <grant permission="bungeni.motion.Edit" role="bungeni.Speaker" />
    <grant permission="bungeni.motion.View" role="bungeni.Speaker" />             
  </state>    

  <state id="motionstates.inadmissible" title="Motion inadmissible">     
    <deny permission="bungeni.motion.Edit" role="bungeni.Speaker" />
  </state>
      
  <state id="motionstates.clarify_clerk" title="Motion needs clarification by Clerks Office">     
    <deny permission="bungeni.motion.Edit" role="bungeni.Speaker" />    
    <grant permission="bungeni.motion.Edit" role="bungeni.Clerk" />
  </state>

  <state id="motionstates.clarify_mp" title="Motion needs clarification by MP">  
    <deny permission="bungeni.motion.Edit" role="bungeni.Clerk" />
    <grant permission="bungeni.motion.Edit" role="bungeni.Speaker" />    
    <deny permission="bungeni.motion.Edit" role="bungeni.Owner" />         
  </state>





  <!-- is scheduled for debate at a sitting -->
  <state id="motionstates.scheduled" title="Motion scheduled">  
    <deny permission="bungeni.motion.Edit" role="bungeni.Clerk" />      
    <deny permission="bungeni.motion.Edit" role="bungeni.Speaker" />
  </state>    
  <!-- admissable motion that cannot be debated -->
  <state id="motionstates.deferred" title="Motion deferred">  

  </state>    
  <!--motion was scheduled for but not debated at the sitting -->
  <state id="motionstates.postponed" title="Motion postponed">  

  </state>    
  <!--defered or postponed motion that were not debated -->
  <state id="motionstates.elapsed" title="Motion elapsed">  
    <deny permission="bungeni.motion.Edit" role="bungeni.Clerk" />      
    <deny permission="bungeni.motion.Edit" role="bungeni.Speaker" />
  </state>    
  <!--a motion was debated  -->
  <state id="motionstates.debated" title="Motion debated">  
    <deny permission="bungeni.motion.Edit" role="bungeni.Clerk" />      
    <deny permission="bungeni.motion.Edit" role="bungeni.Speaker" />
  </state>
  

  <state id="motionstates.withdrawn" title="Motion withdrawn">  
    <deny permission="bungeni.motion.Edit" role="bungeni.Clerk" />      
    <deny permission="bungeni.motion.Edit" role="bungeni.Speaker" />
    <deny permission="bungeni.motion.Edit" role="bungeni.Owner" /> 
  </state>


  <transition
    id="create"
    title="Create"
    trigger="automatic"
    source=""
    destination="motionstates.draft"
    permission=""
    action="bungeni.core.workflows.motion.actions.create"
    condition=""
  />
  <!--transition
    id="make-private"
    title="Make private"
    trigger="manual"
    source="motionstates.draft_motion"
    destination="motionstates.private_motion"
    permission="bungeni.motion.Submit"
    action=""
    condition=""
  /-->
  <!--transition
    id="re-draft"
    title="Re draft"
    trigger="manual"
    source="motionstates.private_motion"
    destination="motionstates.draft_motion"
    permission="bungeni.motion.Submit"
    action=""
    condition=""
  /-->
  
  <transition
    id="submit-to-clerk"
    title="Submit to Clerk"
    trigger="manual"
    source="motionstates.draft"
    destination="motionstates.submitted"
    permission="bungeni.motion.Submit"
    action="bungeni.core.workflows.motion.actions.submit"
    condition=""
    event="bungeni.core.workflows.interfaces.IMotionSubmittedEvent"
  />
  
  <transition
    id="received-by-clerk"
    title="Receive"
    trigger="manual"
    source="motionstates.submitted"
    destination="motionstates.received"
    permission="bungeni.motion.Recieve"
    action="bungeni.core.workflows.motion.actions.recieved_by_clerk"
    condition=""
    event="bungeni.core.workflows.interfaces.IMotionReceivedEvent"
  />
  <transition
    id="require-edit-by-mp"
    title="Needs Clarification by MP"
    trigger="manual"
    source="motionstates.received"
    destination="motionstates.clarify_mp"
    permission="bungeni.motion.clerk.Review"
    action="bungeni.core.workflows.motion.actions.require_edit_by_mp"
    condition=""
    event="bungeni.core.workflows.interfaces.IMotionClarifyEvent"
  />
  <transition
    id="complete"
    title="Complete"
    trigger="manual"
    source="motionstates.received"
    destination="motionstates.complete"
    permission="bungeni.motion.clerk.Review"
    action="bungeni.core.workflows.motion.actions.complete"
    condition=""
  />
  <transition
    id="approve"
    title="Approve"
    trigger="manual"
    source="motionstates.complete"
    destination="motionstates.admissible"
    permission="bungeni.motion.speaker.Review"
    action="bungeni.core.workflows.motion.actions.approve"
    condition=""
  />
  <transition
    id="reject"
    title="Reject"
    trigger="manual"
    source="motionstates.complete"
    destination="motionstates.inadmissible"
    permission="bungeni.motion.speaker.Review"
    action="bungeni.core.workflows.motion.actions.reject"
    condition=""
    event="bungeni.core.workflows.interfaces.IMotionRejectedEvent"
  />
  
  <transition
    id="redraft-inadmissible"
    title="Redraft rejected"
    trigger="manual"
    source="motionstates.inadmissible"
    destination="motionstates.draft"
    permission="bungeni.motion.Reintroduce"
    action=""
    condition=""
    event=""
  />

  
  <transition
    id="require-amendment"
    title="Needs Clarification"
    trigger="manual"
    source="motionstates.complete"
    destination="motionstates.clarify_clerk"
    permission="bungeni.motion.speaker.Review"
    action="bungeni.core.workflows.motion.actions.require_amendment"
    condition=""
  />
  <transition
    id="complete-clarify"
    title="Complete"
    trigger="manual"
    source="motionstates.clarify_clerk"
    destination="motionstates.complete"
    permission="bungeni.motion.clerk.Review"
    action=""
    condition=""
  />
  <transition
    id="mp-clarify"
    title="Needs Clarification by MP"
    trigger="manual"
    source="motionstates.clarify_clerk"
    destination="motionstates.clarify_mp"
    permission="bungeni.motion.clerk.Review"
    action="bungeni.core.workflows.motion.actions.mp_clarify"
    condition=""
    event="bungeni.core.workflows.interfaces.IMotionClarifyEvent"    
  />
  <transition
    id="resubmit-clerk"
    title="Resubmit to clerk"
    trigger="manual"
    source="motionstates.clarify_mp"
    destination="motionstates.submitted"
    permission="bungeni.motion.Submit"
    action="bungeni.core.workflows.motion.actions.submit"
    condition=""
  />
  <transition
    id="schedule"
    title="Schedule"
    trigger="manual"
    source="motionstates.admissible"
    destination="motionstates.scheduled"
    permission="bungeni.motion.Schedule"
    action="bungeni.core.workflows.motion.actions.schedule"
    condition="bungeni.core.workflows.utils.getMotionSchedule"
    event="bungeni.core.workflows.interfaces.IMotionScheduledEvent"
  />
  <transition
    id="defer"
    title="Defer"
    trigger="manual"
    source="motionstates.admissible"
    destination="motionstates.deferred"
    permission="bungeni.motion.Schedule"
    action="bungeni.core.workflows.motion.actions.defer"
    condition=""
    event="bungeni.core.workflows.interfaces.IMotionDeferredEvent"
  />
  <transition
    id="elapse-defered"
    title="Elapse"
    trigger="manual"
    source="motionstates.deferred"
    destination="motionstates.elapsed"
    permission="bungeni.motion.Schedule"
    action="bungeni.core.workflows.motion.actions.elapse"
    condition=""
  />

  <transition
    id="re-admit-elapsed"
    title="Readmit elpapsed"
    trigger="manual"
    source="motionstates.elapsed"
    destination="motionstates.admissible"
    permission="bungeni.motion.Schedule"
    action="bungeni.core.workflows.motion.actions.approve"
    condition=""
  />  
  
  <transition
    id="schedule-deferred"
    title="Schedule"
    trigger="manual"
    source="motionstates.deferred"
    destination="motionstates.scheduled"
    permission="bungeni.motion.Schedule"
    action="bungeni.core.workflows.motion.actions.schedule"
    condition="bungeni.core.workflows.utils.getMotionSchedule"
    event="bungeni.core.workflows.interfaces.IMotionScheduledEvent"    
  />
  <transition
    id="postpone"
    title="Postpone"
    trigger="manual"
    source="motionstates.scheduled"
    destination="motionstates.postponed"
    permission="bungeni.motion.Schedule"
    action="bungeni.core.workflows.motion.actions.postpone"
    condition=""
    event="bungeni.core.workflows.interfaces.IMotionPostponedEvent"
  />
  <transition
    id="debate"
    title="Debate"
    trigger="manual"
    source="motionstates.scheduled"
    destination="motionstates.debated"
    permission="bungeni.motion.Debate"
    action="bungeni.core.workflows.motion.actions.debate"
    condition=""
    event="bungeni.core.workflows.interfaces.IMotionDebatedEvent"
  />
  <transition
    id="schedule-postponed"
    title="Schedule"
    trigger="manual"
    source="motionstates.postponed"
    destination="motionstates.scheduled"
    permission="bungeni.motion.Schedule"
    action="bungeni.core.workflows.motion.actions.schedule"
    condition="bungeni.core.workflows.utils.getMotionSchedule"
    event="bungeni.core.workflows.interfaces.IMotionScheduledEvent"    
  />
  <transition
    id="elapse-postponed"
    title="Elapse"
    trigger="manual"
    source="motionstates.postponed"
    destination="motionstates.elapsed"
    permission="bungeni.motion.Schedule"
    action="bungeni.core.workflows.motion.actions.elapse"
    condition=""
  />
  <transition
    id="withdraw-submitted"
    title="Withdraw"
    trigger="manual"
    source="motionstates.submitted"
    destination="motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motion.actions.withdraw"
    condition=""
  />
  <transition
    id="withdraw-received"
    title="Withdraw"
    trigger="manual"
    source="motionstates.received"
    destination="motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motion.actions.withdraw"
    condition=""
  />
  <transition
    id="withdraw-complete"
    title="Withdraw"
    trigger="manual"
    source="motionstates.complete"
    destination="motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motion.actions.withdraw"
    condition=""
  />
  <transition
    id="withdraw-admissible"
    title="Withdraw"
    trigger="manual"
    source="motionstates.admissible"
    destination="motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motion.actions.withdraw"
    condition=""
  />
  <transition
    id="withdraw-amend"
    title="Withdraw"
    trigger="manual"
    source="motionstates.clarify_mp"
    destination="motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motion.actions.withdraw"
    condition=""
  />
  <transition
    id="withdraw-scheduled"
    title="Withdraw"
    trigger="manual"
    source="motionstates.scheduled"
    destination="motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motion.actions.withdraw"
    condition=""
  />
  <transition
    id="withdraw-deferred"
    title="Withdraw"
    trigger="manual"
    source="motionstates.deferred"
    destination="motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motion.actions.withdraw"
    condition=""
  />
  <transition
    id="withdraw-postponed"
    title="Withdraw"
    trigger="manual"
    source="motionstates.postponed"
    destination="motionstates.withdrawn"
    permission="bungeni.motion.Withdraw"
    action="bungeni.core.workflows.motion.actions.withdraw"
    condition=""
  />
  
  <transition
    id="redraft-withdrawn"
    title="Redraft withdrawn"
    trigger="manual"
    source="motionstates.withdrawn"
    destination="motionstates.draft"
    permission="bungeni.motion.Reintroduce"
    action=""
    condition=""
  />
  
  
</workflow>    
