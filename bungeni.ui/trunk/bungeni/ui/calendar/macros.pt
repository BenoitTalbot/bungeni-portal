<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      i18n:translate="bungeni">

  <div metal:define-macro="weekly">
    <div id="weekly-calendar" class="listing">
      <p><em>Weekly</em></p>

      <div id="calendar-header">
        <table class="listing grid">
          <thead>
            <tr>
              <td colspan="8">
                <a class="previous-link"
                   tal:attributes="href options/links/previous_week"
                   i18n:translate="">
                  &larr;
                </a>
                <a class="next-link"
                   tal:attributes="href options/links/next_week"
                   i18n:translate="">
                  &rarr;
                </a>
                <span i18n:translate=""
                      tal:content="options/formatted_month" />
              </td>
            </tr>
          </thead>
        </table>
      </div>
      
      <div id="calendar-table">
        <table class="listing grid">
          <thead>
            <tr>        
              <th>
                <a i18n:translate=""
                   rel="calendar"
                   tal:attributes="href string:${request/getURL}?${request/QUERY_STRING}">
                  Week <span i18n:name="week_no" tal:replace="options/week_no" />
                </a>
              </th>
              <th tal:repeat="day options/days"
                  tal:attributes="id string:tdid-${day/id}">
                <b tal:content="day/formatted" />
              </th>
            </tr>
          </thead>
        

          <tbody tal:define="sittings_map options/sittings_map">
            <tr tal:repeat="hour options/hours">
              <td class="hour" tal:content="string: ${hour}:00" />
              <tal:column repeat="day python: range(7)">
                <td tal:define="sitting python: sittings_map.get((day, hour), False)"
                    tal:attributes="rowspan sitting/span|nothing;
                                    class sitting/class|nothing;
                                    id string:sitting-${sitting/record/sitting_id}|nothing"
                    tal:condition="python: sitting is not None">
                  <tal:sitting condition="sitting">
                    <ul class="actions">
                      <li tal:repeat="action sitting/actions">
                        <a tal:attributes="rel action/id;
                                           href action/url">
                          <span tal:condition="not: action/icon"
                                tal:replace="action/title" />
                          <img tal:condition="action/icon"
                               tal:attributes="src action/icon;
                                               alt action/title" />
                        </a>
                      </li>
                    </ul>

                    <a rel="sitting" tal:attributes="href sitting/url">
                      <span class="sitting-type" 
                            tal:content="sitting/record/type/sitting_type" />
                    </a>

                    <ul tal:condition="sitting/items">
                      <li tal:repeat="item sitting/items">
                        <a tal:attributes="name item/name;
                                           href item/url"
                           tal:content="item/title" />
                        &mdash;
                        <a class="delete-link"
                           tal:attributes="href item/delete_url">
                          Remove
                        </a>

                        <p class="discreet"
                              tal:content="item/description" />

                      </li>
                    </ul>
                  </tal:sitting>
                </td>
              </tal:column>
            </tr>
          </tbody>
        </table>
      </div>
      
    </div>
  </div>
  
</html>  
